use std::str::FromStr;

use chrono::{DateTime, Duration, Utc};
use lib_api::db::db_error::DbError;
use lib_types::shared::product::{BlockchainStatus, ProductCategory, ProductStatus};
use serde::Serialize;
use sqlx::PgPool;
use uuid::Uuid;

use crate::util::bulk_insert;

#[derive(Serialize)]
pub struct ProductDbProps {
    pub id: Uuid,
    pub user_id: Uuid,
    pub name: String,
    pub description: String,
    pub blurb: String,
    pub contract_address: String,
    pub payout_address: String,
    pub category: ProductCategory,
    pub status: ProductStatus,
    pub blockchain_status: BlockchainStatus,
    pub transaction_hash: Option<String>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

pub async fn seed(db: &PgPool) -> Result<(), DbError> {
    let table = "products";

    let data = vec![
        ProductDbProps {
            id: Uuid::from_str("2f46f1b9-0a24-4a68-bbc7-a26895a54e4d").unwrap(),
            user_id: Uuid::from_str("e10aa33c-94ef-4035-98d1-6372f82454d5").unwrap(),
            name: "Steamed Ham Deck".into(),
            description: "A breakthrough in pork gaming, at this time of year at this time of day in this part of the country localized entirely within your kitchen!\n\nThis product is for demonstration purposes only, purchasing is disabled.".into(),
            blurb: "The world's first hamheld gaming device!".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Games,
            status: ProductStatus::Initial,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(1),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("c55864f1-8a47-4de2-9dd7-80d06479e70f").unwrap(),
            user_id: Uuid::from_str("e10aa33c-94ef-4035-98d1-6372f82454d5").unwrap(),
            name: "Juice Refills".into(),
            description: "Subscription refills for our world famous Juice Machine. Choose between weekly, monthly, or bi-monthly subscriptions.\n\nThis product is for demonstration purposes only, subscribing is disabled.".into(),
            blurb: "The best juice in the world!".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Technology,
            status: ProductStatus::Review,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(5),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("26eb78aa-442f-4470-b724-d4ad090b9010").unwrap(),
            user_id: Uuid::from_str("e10aa33c-94ef-4035-98d1-6372f82454d5").unwrap(),
            name: "Cross Border Donations".into(),
            description: "Donate what you can per month. Everything helps, and use our online platform to track donation usage!\n\nThis is for demonstration purposes only, subscribing is disabled.".into(),
            blurb: "Collecting donations for refugees and asylum seekers.".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Misc,
            status: ProductStatus::Approved,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(10),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("31153d5e-5c78-4156-85ee-fad95a25047b").unwrap(),
            user_id: Uuid::from_str("2199c39f-4fb3-4f72-b685-fe62b90fcef0").unwrap(),
            name: "Twitch Streaming".into(),
            description: "Weekly donations to keep my channel going. 50% of all proceeds go directly back to viewers via streamer rewards.\n\nThis product is for demonstration purposes only, subscribing is disabled.".into(),
            blurb: "Live Streaming Gifts".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Digital,
            status: ProductStatus::Approved,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(15),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("49d5b949-e4a1-4c21-a502-8b1d310698dc").unwrap(),
            user_id: Uuid::from_str("2199c39f-4fb3-4f72-b685-fe62b90fcef0").unwrap(),
            name: "Bad Product".into(),
            description: "A bad product that should be rejected.".into(),
            blurb: "Please Refect".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Digital,
            status: ProductStatus::Denied,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(20),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("a8708f5f-8b91-4cd2-a0e4-bbf1859a52db").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "Running Shoe Subscription".into(),
            description: "We'll ship you cutting age running shoes every year! Choose three pairs from 10 options annually.\n\nThis product is for demonstration purposes only, subscribing is disabled.".into(),
            blurb: "Single run designer boots".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Fashion,
            status: ProductStatus::Approved,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(25),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("cf8550ca-3542-4165-8435-3f5c6c77a761").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "Our Latest Album".into(),
            description: "Purchase the EP of our up and coming Reggae revival band. 10% of proceeds go towards supporting hurricane victims \n\nThis product is for demonstration purposes only, purchasing is disabled.".into(),
            blurb: "A Modern Reggaeton Revival".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Fashion,
            status: ProductStatus::Unavailable,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(30),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("673fad5b-626a-4a74-8cbd-afd45c4cf7d3").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "Subscription Tunes".into(),
            description: "Receive 10 unique digital songs per month, and 1 CD from our catalog.\n\nThis product is for demonstration purposes only, subscribing is disabled.".into(),
            blurb: "Revive the Classics with our Subscription Tunes".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Music,
            status: ProductStatus::Active,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(35),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("7922b138-65dc-412e-87c1-059325574595").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "iPhone Repair".into(),
            description: "All tools and learning materials necessary for repairing any iPhone in your own home.\n\nThis product is for demonstration purposes only, purchasing is disabled.".into(),
            blurb: "iPhone repair tools and lessons".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Misc,
            status: ProductStatus::Active,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(40),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("d105b284-e516-42c1-8690-6612e7cd7bc7").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "Advanced Technology".into(),
            description: "Subscribe to our advanced technology monthly giftbox. We'll send a neat tech gadget to your door every month!\n\nThis is for demonstration purposes, subscribing is disabled.".into(),
            blurb: "Giftbox of the future.".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Technology,
            status: ProductStatus::Unavailable,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(45),
            updated_at: Utc::now(),
        },
        ProductDbProps {
            id: Uuid::from_str("1342c40f-dada-4e12-af3d-6e073ad171a4").unwrap(),
            user_id: Uuid::from_str("90679368-ba27-4d7f-be85-849b4328d93a").unwrap(),
            name: "Community Donation".into(),
            description: "Donate to our community to support monthly events and activities!".into(),
            blurb: "Donate to our community.".into(),
            contract_address: "0x0000000000000000000000000000000000000000".into(),
            payout_address: "0x0000000000000000000000000000000000000000".into(),
            category: ProductCategory::Misc,
            status: ProductStatus::Active,
            blockchain_status: BlockchainStatus::None,
            transaction_hash: None,
            created_at: Utc::now() - Duration::days(50),
            updated_at: Utc::now(),
        },
    ];

    Ok(bulk_insert(&db, table, &data).await?)
}
